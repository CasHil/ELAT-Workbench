<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>ELAT Workbench</title>
    <link rel="shortcut icon" type="image/x-icon" href="icons/favicon.ico">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link href="style/grids.css " rel="stylesheet " type="text/css " />

    <link href="style/main.css " rel="stylesheet " type="text/css " />

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.1/toastr.min.css">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
          integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay"
          crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/css/bootstrap-datepicker.min.css" />

    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.gridster/0.5.6/jquery.gridster.min.css" />

    <script src = "https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/jsstore@2.11.0/dist/jsstore.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsstore@2.11.0/dist/jsstore.worker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sqlweb@1.2.1/dist/sqlweb.min.js"></script>

    <script src="https://cdn.jsdelivr.net/gh/mvallet91/ELAT-Workbench/scripts/pako.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/0.5.7/chartjs-plugin-annotation.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/canvg/1.4/rgbcolor.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvg/dist/browser/canvg.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/save-svg-as-png@1.4.14/lib/saveSvgAsPng.min.js"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.gridster/0.5.6/jquery.gridster.min.js" charset="utf-8"></script>

    <!--<link href="https://fonts.googleapis.com/css?family=Roboto:300,400" rel="stylesheet">-->

</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-light container-fluid">
        <a class="navbar-brand" href="https://mvallet91.github.io/ELAT/">
            <span><img src="img/logonav.png" width="30" alt="Logo"></span> edX Logfile Analysis Tool
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarText">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a class="nav-link" href="https://mvallet91.github.io/ELAT/docs/home/">Learn More</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://mvallet91.github.io/ELAT/docs/quickstart/">Quick Start</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://mvallet91.github.io/ELAT/docs/about/">About</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/mvallet91/ELAT-Workbench" ><i class="fab fa-github fa-2x"></i></a>
                </li>
            </ul>
            <span class="navbar-brand">
                <a class="nav-link pull-right" href="https://www.tudelft.nl/ewi/over-de-faculteit/afdelingen/software-technology/web-information-systems/" ><img src="img/2000px-TU_Delft_Logo.svg.png" width="90px" ></a>
            </span>
        </div>
    </nav>

    <div id="loading" style="display: none"></div>

    <div class="row justify-content-md-center " style="margin-top:10px; ">
        <div class="col-xs-12 col-sm-10  ">
            <table id="tblGrid" class="table table-hover ">
                <caption style="text-align:center;padding:7px 0 7px 0;background:#00A6D6;color:white;font-size:18px;caption-side: top; ">
                    Course Details
                </caption>
                <thead>
                    <tr>
                        <th>Course Name</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Course Elements</th>
                        <th>Enrolled Students</th>
                        <th>Quiz Questions</th>
                        <th>Forum Interactions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <!-- FILE SYSTEM FIELDS /////////////////////////////////////////////////////////////////////// -->
    <div class="row justify-content-md-center " style="margin-top:10px; ">
        <div class="col-xs-12 col-sm-10  ">
            <button type="button" class="btn btn-primary" data-toggle="collapse" data-target="#uploadBoxes" aria-expanded="false"  aria-controls="uploadBoxes">
                Upload Files
            </button>
            <button id="clearDB" type="button" class="btn btn-secondary float-right" >
                Clear Database
            </button>
            <button type="button" class="btn btn-primary " data-toggle="collapse" data-target="#sampleData" aria-expanded="false"  aria-controls="sampleData">
                Sample Data
            </button>
        </div>
        <div class="col-xs-12 col-sm-10  ">
            <div id="uploadBoxes" class="collapse">
                Select all metadata files:<br>
                <input type="file" id="filesInput" multiple >
                <output id="list"></output>
                <br><br>

                Select log files:<br>
                <input type="file" id="logFilesInput" multiple >
                <output id="listLogs"></output>

                <table id="progress_tab">
                </table>
                <table id="progress_time">
                </table>
                <table id="progress_bar">
                </table>
            </div>
        </div>
        <div class="col-xs-12 col-sm-10  ">
            <div id="sampleData" class="collapse">
                <br>
                <div class="col ">
                    <button type="button" class="btn btn-secondary btn-sm" id="populate-fp101">Introduction to Functional Programming</button>
                </div>
                <!--<br>-->
                <!--<div class="col ">-->
                    <!--<button type="button" class="btn btn-secondary btn-sm" id="populate-tw3421"  onclick="populateSamples('TW3421x')">Credit Risk Management</button>-->
                <!--</div>-->
                <!--<br>-->
                <!--<div class="col ">-->
                    <!--<button type="button" class="btn btn-secondary btn-sm" id="populate-ae1110"  onclick="populateSamples('AE1110x')">Introduction to Aeronautical Engineering</button>-->
                <!--</div>-->
                <!--<br>-->
                <!--<div class="col ">-->
                    <!--<button type="button" class="btn btn-secondary btn-sm" id="populate-Visual101x"  onclick="populateSamples('Visual101x')">IMAGE | ABILITY - Visualizing the Unimaginable</button>-->
                <!--</div>-->
                <br>
                <div class="col ">
                    <button type="button" class="btn btn-secondary btn-sm" id="populate-Mind101x"  onclick="populateSamples('Mind101x')">MIND</button>
                </div>
            </div>
        </div>
    </div>

    <div class="row justify-content-md-center " style="margin-top:10px; ">
        <div class="col-xs-12 col-sm-10  ">
            <table id="dbGrid" class="table table-hover ">
                <caption style="text-align:center;padding:7px 0 7px 0;background:#00A6D6;color:white;font-size:18px;caption-side: top; ">
                    Database Details
                </caption>
                <thead>
                    <tr>
                        <th>Course Name</th>
                        <th>General Session</th>
                        <th>Forum Sessions</th>
                        <th>Video Interactions</th>
                        <th>Submissions</th>
                        <th>Assessments</th>
                        <th>Quiz Sessions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>

            <table id="indicatorGrid" class="table table-hover ">
                <caption style="text-align:center;padding:7px 0 7px 0;background:#00A6D6;color:white;font-size:18px;caption-side: top; ">
                    Main Indicators
                </caption>
                <thead>
                <tr>
                    <th>Completion Rate</th>
                    <th>Average Grade <br>(completed course)</th>
                    <th># of Students per<br> Enrollment Mode (E.M.)</th>
                    <th>Avg. Grade by E.M.</th>
                    <th>Avg. Time Spent<br> Watching Video</th>
                    <th>Students that watched<br> at least 1 video</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>

            <table id="dlGrid" class="table table-hover ">
                <caption style="text-align:center;padding:7px 0 7px 0;background:#00A6D6;color:white;font-size:18px;caption-side: top; ">
                    Database Downloads
                </caption>
                <thead>
                <tr>
                    <th>Table</th>
                    <th>General Session</th>
                    <th>Forum Sessions</th>
                    <th>Video Interactions</th>
                    <th>Submissions</th>
                    <th>Assessments</th>
                    <th>Quiz Sessions</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <th><button type="button" class="btn btn-primary btn-sm" id="dl_all">Download All</button></th>
                    <th><button type="button" class="btn btn-primary btn-sm" id="dl_sessions">Download</button></th>
                    <th><button type="button" class="btn btn-primary btn-sm" id="dl_forum">Download</button></th>
                    <th><button type="button" class="btn btn-primary btn-sm" id="dl_vid_sessions">Download</button></th>
                    <th><button type="button" class="btn btn-primary btn-sm" id="dl_submissions">Download</button></th>
                    <th><button type="button" class="btn btn-primary btn-sm" id="dl_assessments">Download</button></th>
                    <th><button type="button" class="btn btn-primary btn-sm" id="dl_quiz">Download</button></th>
                </tr>
                </tbody>
            </table>
            <button type="button" class="btn btn-primary btn-sm" data-toggle="collapse" data-target="#graphOptions" aria-expanded="false" >
                Graph Options
            </button>
            <div id="graphOptions" class="collapse">
                <br>
                <div class="row">
                    <div class="col-lg-3 col-sm-4">
                        <h6>Date Range (time-series charts only)</h6>
                        <div class="form-check" >
                            <label class="form-check-label">
                                <input type="radio" id="allDatesRadio" class="form-check-input" name="optradio" value="allDates" onchange="getGraphElementMap(drawCharts)">
                                All Processed Logs
                            </label>
                        </div>
                        <div class="form-check">
                            <label class="form-check-label">
                                <input type="radio" id="courseDatesRadio" class="form-check-input" name="optradio" value="courseDates" checked onchange="getGraphElementMap(drawCharts)">
                                Official Course Dates
                            </label>
                        </div>
                        <div class="form-check">
                            <label class="form-check-label">
                                Specific Dates - <input type="text" name="daterange" />
                            </label>
                        </div>
                    </div>
                    <div class="col-lg-3 col-sm-4">
                        <h6>Week vs Day</h6>
                        <div class="form-check" >
                            <label class="form-check-label">
                                <input type="radio" id="weeklyRadio" class="form-check-input" name="dayVSweekRadio" value="weekly" checked onchange="getGraphElementMap(drawCharts)">
                                Weekly Values
                            </label>
                        </div>
                        <div class="form-check">
                            <label class="form-check-label">
                                <input type="radio" id="dailyRadio" class="form-check-input" name="dayVSweekRadio" value="daily" onchange="getGraphElementMap(drawCharts)">
                                Daily Values
                            </label>
                        </div>
                    </div>
                </div>
                <br>
                <h6>Update Graph Values</h6>
                <div class="col ">
                    <button type="button" class="btn btn-danger btn-sm" id="updateChartValues" onclick="updateChart()">Update</button>
                </div>
            </div>
        </div>
    </div>

    <div class="gridster">
        <ul>
            <li id="mixedTile" data-row="1" data-col="1" data-sizex="8" data-sizey="4">
                <header>|||</header>
                <div class="container-fluid" id="mixedChartBox">
                    <div id="mixedChart"></div>
                </div>
            </li>
            <li id="heatTile" data-row="1" data-col="9" data-sizex="8" data-sizey="4">
                <header>|||</header>
                <div class="container-fluid" id="heatChartBox">
                    <div id="heatChart"></div>
                </div>
            </li>
            <li id="lineTile" data-row="5" data-col="1" data-sizex="8" data-sizey="4">
                <header>|||</header>
                <div class="container-fluid" id="lineChartBox" >
                    <div class="dropdown">
                        <button type="button" class="btn btn-sm dropdown-toggle" data-toggle="dropdown" style="float:right;">
                            <i class="fas fa-download"></i>
                        </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" onclick="exportChartPNG('lineChart')">Download PNG</a>
                        </div>
                    </div>
                    <canvas style = "position:relative; top:-10px;" id="lineChart"></canvas>
                </div>
            </li>
            <li id="boxTile" data-row="5" data-col="9" data-sizex="8" data-sizey="4">
                <header>|||</header>
                <div class="container-fluid " id="boxChartBox">
                    <div class="dropdown">
                        <button type="button" class="btn btn-sm dropdown-toggle" data-toggle="dropdown" style="float:right;">
                            <i class="fas fa-download"></i>
                        </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" onclick="exportChartPNG('boxChart')">Download PNG</a>
                        </div>
                    </div>
                    <canvas style = "position:relative; top:-10px;" id="boxChart"></canvas>
                </div>
            </li>
            <li id="areaTile" data-row="9" data-col="1" data-sizex="8" data-sizey="4">
                <header>|||</header>
                <div class="container-fluid " id="areaChartBox">
                    <div class="dropdown">
                        <button type="button" class="btn btn-sm dropdown-toggle" data-toggle="dropdown" style="float:right;">
                            <i class="fas fa-download"></i>
                        </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" onclick="exportChartPNG('areaChart')">Download PNG</a>
                        </div>
                    </div>
                    <canvas style = "position:relative; top:-10px;" id="areaChart"></canvas>
                </div>
            </li>
            <li id="arcTile" data-row="9" data-col="9" data-sizex="8" data-sizey="4">
                <header>|||</header>
                <div class="container-fluid " id="arcChartBox">
                    <form>
                        <div class="dropdown">
                            <button type="button" class="btn btn-sm dropdown-toggle" data-toggle="dropdown" style="float:right;">
                                <i class="fas fa-download"></i>
                            </button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" onclick="exportChartPNG('arcChart')">Download PNG</a>
                            </div>
                        </div>
                        <label for="links" style="float:right;"> - Number of Links</label>
                        <input  type="range" min=10 max=500 step=10 id="links" value=30 style="float:right;">
                        <label style="float:left;" for="arcType">Student Status - </label>
                        <select name="type" id="arcType" style="float:left;">
                            <option value="general">Everyone</option>
                            <option value="passing">Passing Only</option>
                            <option value="failing">Failing Only</option>
                        </select>
                    </form>
                    <div style="width: 100%; overflow-x:auto; overflow-y:hidden" >
                        <div style="height: 400px">
                            <div id="arcChart"></div>
                        </div>
                    </div>
                </div>
            </li>
            <li id="cycleTile" data-row="13" data-col="1" data-sizex="9" data-sizey="4">
                <header>|||</header>
                <div class="container-fluid  " id="cycleChartBox">
                    <form>
                        <div class="dropdown">
                            <button type="button" class="btn btn-sm dropdown-toggle" data-toggle="dropdown" style="float:right;">
                                <i class="fas fa-download"></i>
                            </button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" onclick="exportChartPNG('cycleChart')">Download PNG</a>
                            </div>
                        </div>
                        <label for="linksCycle" style="float:right;"> - Number of Links</label>
                        <input type="range" min=0 max=100 step=10 id="linksCycle" value=30 style="float:right;">
                        <label style="float:left;" for="cycleType">Student Status - </label>
                        <select name="type" id="cycleType" style="float:left;">
                            <option value="downloadable">Passing Only</option>
                            <option value="notpassing">Failing Only</option>
                            <option value="general">Passing and Failing</option>
                            <option value="designed">Designed</option>
                        </select>
                        <label for="cycleWeek" > Week - </label>
                        <input  id="cycleWeek" type="number" min="1" max=getMaxWeeks() step="1" value="1" required
                                style="width: 6ch;">
                    </form>
                    <div id="cycleChart" ></div>
                </div>
            </li>
        </ul>
    </div>

    <script src = "https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.15.0/umd/popper.min.js"></script>
    <script src = "https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.1/toastr.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/blockui@1.0.0/jquery.blockUI.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/apexcharts@3.8.1/dist/apexcharts.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chartjs-chart-box-and-violin-plot@2.1.0/build/Chart.BoxPlot.min.js"></script>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@shopify/draggable@1.0.0-beta.5/lib/draggable.bundle.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@shopify/draggable@1.0.0-beta.5/lib/swappable.js"></script>

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />

    <script type="module" src="scripts/index.js"></script>
    <script type="module" src="scripts/metadataProcessing.js"></script>
    <script type="module" src="scripts/prepareTables.js"></script>
    <script type="module" src="scripts/databaseHelpers.js"></script>
    <script type="module" src="scripts/helpers.js"></script>


    <script>
        let lineChart = null;
        let areaChart = null;
        let boxChart = null;
        let mixedChart = null;
        let arcChart = null;
        let heatChart = null;
        $(function() {
            $('input[name="daterange"]').daterangepicker({
                opens: 'left'
            }, function(start, end, label) {
                document.getElementById('allDatesRadio').checked = false;
                document.getElementById('courseDatesRadio').checked = false;
                getGraphElementMap(drawCharts, start.format('YYYY-MM-DD'), end.format('YYYY-MM-DD'));
            });
        });
    </script>

</body>
</html>